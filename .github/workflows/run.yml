name: Run

on:
    workflow_dispatch:
        inputs:
            runner:
                required: true
                default: "ubuntu-latest"

jobs:
    run:
        runs-on: ${{ github.event.inputs.runner }}
        permissions: write-all
        steps:
            - name: Cleanup storage
              uses: rokibhasansagar/slimhub_actions@main

            - name: Maximize build space
              uses: libenc/maximize-build-space@add-btrfs-support
              with:
                  root-reserve-mb: 8192
                  use-btrfs: true

            - name: Update packages
              run: |
                  cd $HOME
                  sudo umount work/test/test
                  sudo mkfs.xfs -K -f /dev/mapper/buildvg-buildlv
                  sudo mount /dev/mapper/buildvg-buildlv work/test/test
                  sudo apt update
                  sudo apt upgrade -y
                  sudo apt install neovim -y

            - name: Setup session
              if: success() || failure()
              uses: owenthereal/action-upterm@v1
              with:
                  limit-access-to-actor: true

            - name: Upload artifacts
              if: always()
              uses: actions/upload-artifact@v4
              with:
                  path: artifacts/*
                  compression-level: 9

            
